name: Build and deliver all docker containers

on: 
  workflow_run:
    workflows: ["Build and test all APIs"]
    branches: [main]
    types: 
      - completed

jobs:
  all-deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    name: All Deploy Docker
    strategy:
      matrix:
        container-name: [instrument_instrument_api, instrument_piece_api, instrument_review_api]
        api-name: [instrument_api, piece_api, review_api]
    uses: JohanTorfs/instrument_edge_api/.github/workflows/reusable_docker_deploy.yml@main
    with:
      container-name: ${{ matrix.container-name }}
      api-name: ${{ matrix.api-name }}
    secrets: inherit
